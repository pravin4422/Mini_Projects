<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Academic Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #28a745, #20c997);
            --danger-gradient: linear-gradient(135deg, #dc3545, #c82333);
            --warning-gradient: linear-gradient(135deg, #ffc107, #e0a800);
            --info-gradient: linear-gradient(135deg, #17a2b8, #138496);
            --purple-gradient: linear-gradient(135deg, #6f42c1, #5a32a3);
            --shadow-light: 0 4px 15px rgba(0, 0, 0, 0.1);
            --shadow-medium: 0 8px 25px rgba(0, 0, 0, 0.15);
            --shadow-heavy: 0 15px 35px rgba(0, 0, 0, 0.2);
            --border-radius: 15px;
            --border-radius-small: 10px;
            --spacing-xs: 8px;
            --spacing-sm: 12px;
            --spacing-md: 20px;
            --spacing-lg: 30px;
            --font-size-xs: 12px;
            --font-size-sm: 14px;
            --font-size-md: 16px;
            --font-size-lg: 18px;
            --font-size-xl: 24px;
            
            /* Light Theme Variables */
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --text-primary: #333333;
            --text-secondary: #495057;
            --text-tertiary: #6c757d;
            --border-primary: #e9ecef;
            --border-secondary: #dee2e6;
            --input-bg: #f8f9fa;
            --input-focus-bg: #ffffff;
            --paper-bg: #ffffff;
            --container-bg: rgba(255, 255, 255, 0.98);
            --tab-bg: #f8f9fa;
            --result-bg: #f8f9fa;
            --pass-bg: linear-gradient(135deg, #d4edda, #c3e6cb);
            --pass-border: #28a745;
            --pass-text: #155724;
            --fail-bg: linear-gradient(135deg, #f8d7da, #f5c6cb);
            --fail-border: #dc3545;
            --fail-text: #721c24;
        }

        [data-theme="dark"] {
            --bg-primary: #1a202c;
            --bg-secondary: #2d3748;
            --bg-tertiary: #4a5568;
            --text-primary: #e2e8f0;
            --text-secondary: #cbd5e0;
            --text-tertiary: #a0aec0;
            --border-primary: #4a5568;
            --border-secondary: #718096;
            --input-bg: #2d3748;
            --input-focus-bg: #4a5568;
            --paper-bg: #2d3748;
            --container-bg: rgba(26, 32, 44, 0.98);
            --tab-bg: #2d3748;
            --result-bg: #2d3748;
            --pass-bg: linear-gradient(135deg, #276749, #2f855a);
            --pass-border: #38a169;
            --pass-text: #9ae6b4;
            --fail-bg: linear-gradient(135deg, #742a2a, #9b2c2c);
            --fail-border: #e53e3e;
            --fail-text: #fed7d7;
            --shadow-light: 0 4px 15px rgba(0, 0, 0, 0.3);
            --shadow-medium: 0 8px 25px rgba(0, 0, 0, 0.4);
            --shadow-heavy: 0 15px 35px rgba(0, 0, 0, 0.5);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--primary-gradient);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--container-bg);
            box-shadow: var(--shadow-heavy);
            backdrop-filter: blur(20px);
            min-height: 100vh;
            transition: all 0.3s ease;
        }

        .header {
            background: var(--primary-gradient);
            padding: var(--spacing-lg);
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .header h1 {
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            margin-bottom: var(--spacing-sm);
            position: relative;
            z-index: 1;
            font-weight: 700;
        }

        .header p {
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }

        /* Theme Toggle Button */
        .theme-toggle {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50px;
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            font-weight: 600;
            font-size: var(--font-size-sm);
            backdrop-filter: blur(10px);
            z-index: 10;
            touch-action: manipulation;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .theme-icon {
            font-size: 16px;
            transition: transform 0.3s ease;
        }

        .main-tabs {
            display: flex;
            background: var(--tab-bg);
            border-bottom: 2px solid var(--border-primary);
            position: sticky;
            top: 0;
            z-index: 100;
            transition: all 0.3s ease;
        }

        .main-tab-btn {
            flex: 1;
            padding: var(--spacing-md);
            background: none;
            border: none;
            font-size: var(--font-size-lg);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            touch-action: manipulation;
            color: var(--text-secondary);
        }

        .main-tab-btn::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 3px;
            background: var(--primary-gradient);
            transition: width 0.3s ease;
        }

        .main-tab-btn:hover::before,
        .main-tab-btn.active::before {
            width: 100%;
        }

        .main-tab-btn.active {
            background: var(--primary-gradient);
            color: white;
        }

        .main-tab-content {
            display: none;
            padding: var(--spacing-md);
            animation: fadeIn 0.5s ease-in;
            min-height: calc(100vh - 200px);
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .main-tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Enhanced Mobile-First Credit Calculator Styles */
        .credit-tabs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-lg);
            background: var(--tab-bg);
            border-radius: var(--border-radius);
            padding: var(--spacing-xs);
            transition: all 0.3s ease;
        }

        .tab-btn {
            padding: var(--spacing-sm) var(--spacing-xs);
            background: none;
            border: none;
            border-radius: var(--border-radius-small);
            font-size: var(--font-size-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            touch-action: manipulation;
            white-space: nowrap;
            text-align: center;
            color: var(--text-secondary);
        }

        .tab-btn.active {
            background: var(--primary-gradient);
            color: white;
            box-shadow: var(--shadow-light);
            transform: translateY(-2px);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .paper {
            background: var(--paper-bg);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-primary);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            color: var(--text-primary);
        }

        .paper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary-gradient);
        }

        .paper:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-weight: 600;
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            border: 2px solid var(--border-primary);
            border-radius: var(--border-radius-small);
            font-size: var(--font-size-md);
            transition: all 0.3s ease;
            background: var(--input-bg);
            color: var(--text-primary);
            appearance: none;
            -webkit-appearance: none;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            background: var(--input-focus-bg);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Enhanced Mobile Button Layout */
        .button-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: var(--spacing-sm);
            margin-top: var(--spacing-md);
        }

        .btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: var(--border-radius-small);
            font-size: var(--font-size-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            touch-action: manipulation;
            text-align: center;
            min-height: 44px; /* Touch-friendly minimum */
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-calculate { background: var(--success-gradient); color: white; }
        .btn-save { background: var(--info-gradient); color: white; }
        .btn-reset { background: var(--warning-gradient); color: white; }
        .btn-delete { background: var(--danger-gradient); color: white; }
        .btn-pdf { background: var(--purple-gradient); color: white; }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .add-paper-btn {
            background: var(--info-gradient);
            color: white;
            padding: var(--spacing-md);
            font-size: var(--font-size-md);
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            margin: var(--spacing-md) 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-light);
            width: 100%;
            min-height: 50px;
            touch-action: manipulation;
        }

        .add-paper-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .result {
            margin-top: var(--spacing-md);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
            font-weight: 500;
            background: var(--result-bg);
            border: 2px solid var(--border-primary);
            transition: all 0.3s ease;
            color: var(--text-primary);
        }

        .result.pass {
            background: var(--pass-bg);
            border-color: var(--pass-border);
            color: var(--pass-text);
        }

        .result.fail {
            background: var(--fail-bg);
            border-color: var(--fail-border);
            color: var(--fail-text);
        }

        .status {
            text-align: center;
            padding: var(--spacing-md);
            border-radius: var(--border-radius-small);
            font-size: var(--font-size-lg);
            font-weight: 700;
            margin: var(--spacing-md) 0;
        }

        .status.pass {
            background: var(--success-gradient);
            color: white;
        }

        .status.fail {
            background: var(--danger-gradient);
            color: white;
        }

        /* Enhanced CGPA Calculator for Mobile */
        .cgpa-section {
            background: var(--paper-bg);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-light);
            margin-bottom: var(--spacing-lg);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .cgpa-input-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        .cgpa-form {
            display: grid;
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
        }

        .subject-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            background: var(--bg-secondary);
            border-radius: var(--border-radius-small);
            border: 2px solid var(--border-primary);
            transition: all 0.3s ease;
        }

        .subject-row:hover,
        .subject-row:focus-within {
            border-color: #667eea;
            box-shadow: var(--shadow-light);
        }

        .cgpa-result {
            background: var(--primary-gradient);
            color: white;
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
            text-align: center;
            font-size: var(--font-size-lg);
            margin-top: var(--spacing-md);
            box-shadow: var(--shadow-medium);
        }

        /* Enhanced Toast Notifications */
        .toast {
            position: fixed;
            top: var(--spacing-md);
            right: var(--spacing-md);
            left: var(--spacing-md);
            padding: var(--spacing-md);
            border-radius: var(--border-radius-small);
            color: white;
            font-weight: 600;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-100%);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-heavy);
            max-width: 400px;
            margin: 0 auto;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.success { background: var(--success-gradient); }
        .toast.error { background: var(--danger-gradient); }
        .toast.info { background: var(--info-gradient); }

        .error {
            color: #dc3545;
            font-size: var(--font-size-xs);
            margin-top: var(--spacing-xs);
            font-weight: 600;
        }

        /* Enhanced Saved Results */
        .saved-result {
            background: var(--paper-bg);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-light);
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
            color: var(--text-primary);
        }

        .saved-result:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .saved-date {
            color: var(--text-tertiary);
            font-size: var(--font-size-sm);
            margin-bottom: var(--spacing-sm);
        }

        /* Mobile-First Responsive Grid Layouts */
        .mobile-grid-2 {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-md);
        }.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.success { background: var(--success-gradient); }
        .toast.error { background: var(--danger-gradient); }
        .toast.info { background: var(--info-gradient); }

        .error {
            color: #dc3545;
            font-size: var(--font-size-xs);
            margin-top: var(--spacing-xs);
            font-weight: 600;
        }

        /* Enhanced Saved Results */
        .saved-result {
            background: white;
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-light);
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
        }

        .saved-result:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .saved-date {
            color: #6c757d;
            font-size: var(--font-size-sm);
            margin-bottom: var(--spacing-sm);
        }

        /* Mobile-First Responsive Grid Layouts */
        .mobile-grid-2 {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-md);
        }

        /* Enhanced Floating Action Button */
        .fab {
            position: fixed;
            bottom: var(--spacing-lg);
            right: var(--spacing-lg);
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--primary-gradient);
            color: white;
            border: none;
            font-size: 20px;
            cursor: pointer;
            box-shadow: var(--shadow-medium);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            touch-action: manipulation;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-heavy);
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Enhanced Mobile Responsiveness */
        @media (min-width: 768px) {
            .container {
                border-radius: var(--border-radius);
                margin: var(--spacing-md);
                min-height: calc(100vh - 40px);
            }

            .mobile-grid-2 {
                grid-template-columns: 1fr 1fr;
            }

            .subject-row {
                grid-template-columns: 2fr 1fr 1fr;
            }

            .button-group {
                grid-template-columns: repeat(4, 1fr);
            }

            .credit-tabs {
                grid-template-columns: repeat(4, 1fr);
            }

            .cgpa-input-group {
                flex-direction: row;
                align-items: end;
            }
        }

        @media (min-width: 1024px) {
            .main-tab-content {
                padding: var(--spacing-lg);
            }

            .paper {
                padding: var(--spacing-lg);
            }
        }

        /* Touch and Accessibility Improvements */
        @media (hover: none) and (pointer: coarse) {
            .btn:hover::before {
                display: none;
            }

            .paper:hover {
                transform: none;
            }

            .add-paper-btn:hover {
                transform: none;
            }
        }

        /* Dark mode support - remove old media query */
        
        /* Enhanced animations */
        .paper {
            animation: slideInUp 0.6s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Focus indicators for accessibility */
        .btn:focus,
        .tab-btn:focus,
        .main-tab-btn:focus {
            outline: 2px solid #667eea;
            outline-offset: 2px;
        }

        /* High contrast support */
        @media (prefers-contrast: high) {
            .btn {
                border: 2px solid currentColor;
            }

            .paper {
                border: 2px solid var(--border-secondary);
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
                <span class="theme-icon" id="theme-icon">🌙</span>
                <span id="theme-text">Dark</span>
            </button>
            <h1>Ultimate Academic Calculator</h1>
            <p>Your complete mobile-friendly solution for credit calculations and CGPA tracking</p>
        </div>

        <div class="main-tabs">
            <button class="main-tab-btn active" onclick="switchMainTab('credit-calc')">
                 Credit Calculator
            </button>
            <button class="main-tab-btn" onclick="switchMainTab('cgpa-calc')">
                 CGPA Calculator
            </button>
        </div>

        <!-- Credit Calculator Section -->
        <div id="credit-calc" class="main-tab-content active">
            <div class="credit-tabs">
                <button class="tab-btn active" onclick="switchTab('credit-3')">3 Credits</button>
                <button class="tab-btn" onclick="switchTab('credit-4')">4 Credits</button>
                <button class="tab-btn" onclick="switchTab('credit-4-5')">4.5 Credits</button>
                <button class="tab-btn" onclick="switchTab('saved')"> Saved</button>
            </div>

            <div id="credit-3" class="tab-content active">
                <h3>3 Credit Papers</h3>
                <p><strong>Formula:</strong> Internal (A1×30% + A2×30% + Activity) + Theory×60%</p>
                <div id="papers-3"></div>
                <button class="add-paper-btn" onclick="addPaper('3')"> Add Another Paper</button>
            </div>

            <div id="credit-4" class="tab-content">
                <h3>4 Credit Papers</h3>
                <p><strong>Formula:</strong> Internal (A1×40% + A2×40% + Activity + Lab) + Theory×25%</p>
                <div id="papers-4"></div>
                <button class="add-paper-btn" onclick="addPaper('4')"> Add Another Paper</button>
            </div>

            <div id="credit-4-5" class="tab-content">
                <h3>4.5 Credit Papers</h3>
                <p><strong>Formula:</strong> Internal (A1×40% + A2×40% + Activity + Lab) + Theory×25%</p>
                <div id="papers-4.5"></div>
                <button class="add-paper-btn" onclick="addPaper('4.5')"> Add Another Paper</button>
            </div>

            <div id="saved" class="tab-content">
                <h3> Saved Results</h3>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-delete" onclick="clearAllResults()"> Clear All Results</button>
                </div>
                <div id="saved-results"></div>
            </div>
        </div>

        <!-- CGPA Calculator Section -->
        <div id="cgpa-calc" class="main-tab-content">
            <div class="cgpa-section">
                <h3> CGPA Calculator (Letter Grades)</h3>
                <p>Calculate your Cumulative Grade Point Average using letter grades</p>
                
                <div class="cgpa-input-group">
                    <div class="form-group">
                        <label for="num-subjects">Number of Subjects:</label>
                        <input type="number" id="num-subjects" min="1" max="20" value="3" />
                    </div>
                    <button class="btn btn-calculate" id="generate-inputs">Generate Inputs</button>
                </div>

                <form id="subjects-form" class="cgpa-form"></form>

                <button class="btn btn-calculate" id="calculate-cgpa" style="margin-top: 20px; width: 100%; padding: 15px;">
                     Calculate CGPA
                </button>

                <div id="cgpa-result" class="cgpa-result" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <button class="fab" onclick="scrollToTop()" aria-label="Scroll to top">↑</button>

    <script>
        // In-memory storage for Claude.ai compatibility
        let savedResults = [];
        let currentTheme = 'light';

        // Theme management
        function initializeTheme() {
            // Check if user has a saved preference
            const savedTheme = localStorage?.getItem('theme') || 'light';
            currentTheme = savedTheme;
            
            // Apply theme
            document.documentElement.setAttribute('data-theme', currentTheme);
            updateThemeButton();
        }

        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', currentTheme);
            
            // Save preference if localStorage is available
            try {
                localStorage.setItem('theme', currentTheme);
            } catch (e) {
                // localStorage not available, continue without saving
            }
            
            updateThemeButton();
            showToast(`Switched to ${currentTheme} theme!`, 'info');
        }

        function updateThemeButton() {
            const themeIcon = document.getElementById('theme-icon');
            const themeText = document.getElementById('theme-text');
            
            if (currentTheme === 'dark') {
                themeIcon.textContent = '☀️';
                themeText.textContent = 'Light';
            } else {
                themeIcon.textContent = '🌙';
                themeText.textContent = 'Dark';
            }
        }

        // Grade mapping for CGPA calculation
        const gradeMap = {
            'O': 10,
            'A+': 9,
            'A': 8,
            'B+': 7,
            'B': 6,
            'C': 5,
            'F': 0
        };

        // Enhanced storage functions
        function saveToStorage(key, data) {
            if (key === 'creditCalculatorResults') {
                savedResults = JSON.parse(JSON.stringify(data));
            }
        }

        function loadFromStorage(key) {
            if (key === 'creditCalculatorResults') {
                return JSON.parse(JSON.stringify(savedResults));
            }
            return [];
        }

        function clearStorage(key) {
            if (key === 'creditCalculatorResults') {
                savedResults = [];
            }
        }

        // Enhanced toast notification function
        function showToast(message, type = 'info') {
            // Remove existing toasts
            document.querySelectorAll('.toast').forEach(toast => toast.remove());
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'polite');
            document.body.appendChild(toast);
            
            // Trigger animation
            requestAnimationFrame(() => {
                toast.classList.add('show');
            });
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, 400);
            }, 4000);
        }

        // Enhanced main tab switching
        function switchMainTab(tabName) {
            document.querySelectorAll('.main-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.main-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Add smooth scroll to content
            document.getElementById(tabName).scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }

        // Enhanced credit calculator tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'saved') {
                loadSavedResults();
            }
        }

        // Enhanced validation function
        function validateInput(value, min = 0, max = 100) {
            const num = parseFloat(value);
            return !isNaN(num) && num >= min && num <= max && value.trim() !== '';
        }

        // Enhanced calculation with better mobile UX
        function calculateResult(paperDiv, credit) {
            const subject = paperDiv.querySelector('.subject').value.trim();
            const a1Input = paperDiv.querySelector('.assessment1');
            const a2Input = paperDiv.querySelector('.assessment2');
            const activityInput = paperDiv.querySelector('.activity');
            const theoryInput = paperDiv.querySelector('.theory');
            const labInput = paperDiv.querySelector('.lab');

            // Clear previous errors
            paperDiv.querySelectorAll('.error').forEach(el => el.remove());

            let hasError = false;

            // Validate inputs with better error messages
            const inputs = [
                { input: a1Input, name: 'Assessment 1', max: 50 },
                { input: a2Input, name: 'Assessment 2', max: 50 },
                { input: activityInput, name: 'Activity', max: 10 },
                { input: theoryInput, name: 'Theory', max: 100 }
            ];

            if (labInput) {
                inputs.push({ input: labInput, name: 'Lab', max: 100 });
            }

            inputs.forEach(({ input, name, max }) => {
                if (!input.value.trim()) {
                    const error = document.createElement('div');
                    error.className = 'error';
                    error.textContent = `${name} is required`;
                    input.parentNode.appendChild(error);
                    hasError = true;
                } else if (!validateInput(input.value, 0, max)) {
                    const error = document.createElement('div');
                    error.className = 'error';
                    error.textContent = `${name} must be between 0 and ${max}`;
                    input.parentNode.appendChild(error);
                    hasError = true;
                }
            });

            if (hasError) {
                showToast('Please fix the validation errors', 'error');
                // Focus on first error input
                const firstError = paperDiv.querySelector('.error');
                if (firstError) {
                    const errorInput = firstError.previousElementSibling;
                    if (errorInput) {
                        errorInput.focus();
                        errorInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
                return;
            }

            const a1 = parseFloat(a1Input.value);
            const a2 = parseFloat(a2Input.value);
            const activity = parseFloat(activityInput.value);
            const theory = parseFloat(theoryInput.value);
            const lab = labInput ? parseFloat(labInput.value) : 0;

            let internalTotal = 0;
            let theoryWeight = 0;
            let total = 0;

            if (credit === '3') {
                internalTotal = (a1 * 0.3) + (a2 * 0.3) + activity;
                theoryWeight = 0.6;
                total = internalTotal + (theory * theoryWeight);
            } else {
                internalTotal = (a1 * 0.4) + (a2 * 0.4) + activity + lab;
                theoryWeight = 0.25;
                total = internalTotal + (theory * theoryWeight);
            }

            const resultDiv = paperDiv.querySelector('.result');
            const isPassing = total >= 50;

            // Enhanced mobile-friendly result display
            let resultHTML = '';
            if (subject) {
                resultHTML += `<div style="font-size: 18px; font-weight: bold; margin-bottom: 15px; text-align: center;">📚 ${subject}</div>`;
            }

            resultHTML += `
                <div class="mobile-grid-2" style="margin-bottom: 20px;">
                    <div style="background: rgba(102, 126, 234, 0.1); padding: 15px; border-radius: 10px;">
                        <strong style="color: #667eea;"> Internal Components:</strong><br>
                        Assessment 1: ${a1} × ${credit === '3' ? '30%' : '40%'} = ${(a1 * (credit === '3' ? 0.3 : 0.4)).toFixed(2)}<br>
                        Assessment 2: ${a2} × ${credit === '3' ? '30%' : '40%'} = ${(a2 * (credit === '3' ? 0.3 : 0.4)).toFixed(2)}<br>
                        Activity: ${activity}<br>
                        ${labInput ? `Lab: ${lab}<br>` : ''}
                        <strong style="font-size: 16px; color: #667eea;">Internal Total: ${internalTotal.toFixed(2)}</strong>
                    </div>
                    <div style="background: rgba(40, 167, 69, 0.1); padding: 15px; border-radius: 10px;">
                        <strong style="color: #28a745;"> Theory Component:</strong><br>
                        Theory: ${theory} × ${(theoryWeight * 100).toFixed(0)}% = ${(theory * theoryWeight).toFixed(2)}<br><br>
                        <strong style="font-size: 18px; color: #28a745;">Final Total: ${total.toFixed(2)}</strong>
                    </div>
                </div>
            `;

            if (isPassing) {
                resultHTML += `<div class="status pass"> PASS - Congratulations!</div>`;
                resultDiv.className = 'result pass';
                showToast('Calculation completed - PASS!', 'success');
            } else {
                const minInternalRequired = Math.max(0, 50 - (theory * theoryWeight));
                const minTheoryRequired = Math.max(0, (50 - internalTotal) / theoryWeight);

                resultHTML += `
                    <div class="status fail"> FAIL - Need Improvement</div>
                    <div style="margin-top: 15px; padding: 15px; background: rgba(220, 53, 69, 0.1); border-radius: 10px; border-left: 4px solid #dc3545;">
                        <strong> To Pass (50 marks minimum):</strong><br>
                        Minimum Internal Required: ${minInternalRequired.toFixed(2)}<br>
                        Minimum Theory Required: ${minTheoryRequired.toFixed(2)}
                    </div>
                `;
                resultDiv.className = 'result fail';
                showToast('Calculation completed - Review required', 'error');
            }

            resultDiv.innerHTML = resultHTML;

            // Smooth scroll to results on mobile
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            // Store result data for saving
            const resultData = {
                subject,
                a1,
                a2,
                activity,
                theory,
                lab,
                internalTotal,
                theoryWeight,
                total,
                isPassing
            };

            // Enable save button functionality
            const saveBtn = paperDiv.querySelector('.btn-save');
            if (saveBtn) {
                saveBtn.disabled = false;
                saveBtn.onclick = () => saveResult(paperDiv, credit, resultData);
            }
        }

        // Enhanced save result function
        function saveResult(paperDiv, credit, resultData) {
            const subject = paperDiv.querySelector('.subject').value.trim() || 'Untitled Paper';
            const savedData = loadFromStorage('creditCalculatorResults');
            
            const newResult = {
                id: Date.now(),
                subject: subject,
                credit: credit,
                date: new Date().toLocaleDateString(),
                time: new Date().toLocaleTimeString(),
                data: resultData,
                resultHTML: paperDiv.querySelector('.result').innerHTML
            };
            
            savedData.push(newResult);
            saveToStorage('creditCalculatorResults', savedData);
            showToast('Result saved successfully!', 'success');
        }

        // Enhanced load saved results function
        function loadSavedResults() {
            const savedData = loadFromStorage('creditCalculatorResults');
            const container = document.getElementById('saved-results');
            
            if (savedData.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <div style="font-size: 48px; margin-bottom: 20px;">📭</div>
                        <h3>No saved results found</h3>
                        <p>Calculate some papers to see them here!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            savedData.reverse().forEach(result => {
                const savedDiv = document.createElement('div');
                savedDiv.className = 'saved-result';
                
                savedDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                        <h4 style="margin: 0;"> ${result.subject} (${result.credit} Credits)</h4>
                        <span style="font-size: 12px; color: #666; white-space: nowrap; margin-left: 10px;">${result.data.isPassing ? '✅' : '❌'}</span>
                    </div>
                    <div class="saved-date"> Saved on ${result.date} at ${result.time}</div>
                    <div class="saved-content" style="margin: 15px 0;">${result.resultHTML}</div>
                    <div class="button-group">
                        <button class="btn btn-delete" onclick="deleteSavedResult(${result.id})"> Delete</button>
                        <button class="btn btn-pdf" onclick="exportSavedResultToPDF(${result.id})"> PDF</button>
                    </div>
                `;
                
                container.appendChild(savedDiv);
            });
        }

        // Enhanced delete saved result function
        function deleteSavedResult(id) {
            if (confirm('Are you sure you want to delete this saved result?')) {
                const savedData = loadFromStorage('creditCalculatorResults');
                const filteredData = savedData.filter(result => result.id !== id);
                saveToStorage('creditCalculatorResults', filteredData);
                loadSavedResults();
                showToast('Result deleted successfully!', 'info');
            }
        }

        // Enhanced clear all results function
        function clearAllResults() {
            if (confirm('Are you sure you want to delete ALL saved results? This action cannot be undone.')) {
                clearStorage('creditCalculatorResults');
                loadSavedResults();
                showToast('All results cleared!', 'info');
            }
        }

        // Enhanced export to PDF function
        function exportSavedResultToPDF(id) {
            const savedData = loadFromStorage('creditCalculatorResults');
            const result = savedData.find(r => r.id === id);
            
            if (!result) return;
            
            showToast('Preparing PDF export...', 'info');
            
            const element = document.createElement('div');
            element.innerHTML = `
                <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 30px; max-width: 800px;">
                    <div style="text-align: center; margin-bottom: 30px; border-bottom: 2px solid #667eea; padding-bottom: 20px;">
                        <h1 style="color: #667eea; margin: 0;">🎓 Academic Calculator Result</h1>
                        <p style="color: #666; margin: 10px 0 0 0;">Generated on ${new Date().toLocaleDateString()}</p>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <h2 style="color: #333; margin-bottom: 10px;"> ${result.subject} (${result.credit} Credits)</h2>
                        <p style="color: #666;"><strong>Calculated:</strong> ${result.date} at ${result.time}</p>
                    </div>
                    <hr style="border: none; border-top: 1px solid #eee; margin: 20px 0;">
                    <div style="line-height: 1.6;">${result.resultHTML}</div>
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; text-align: center; color: #666; font-size: 12px;">
                        <p>Generated by Ultimate Academic Calculator</p>
                    </div>
                </div>
            `;
            
            const opt = {
                margin: 0.5,
                filename: `${result.subject.replace(/[^a-z0-9]/gi, '_')}_${result.date.replace(/\//g, '-')}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
            };
            
            html2pdf().set(opt).from(element).save().then(() => {
                showToast('PDF exported successfully!', 'success');
            }).catch(() => {
                showToast('PDF export failed. Please try again.', 'error');
            });
        }

        // Enhanced reset paper function
        function resetPaper(paperDiv) {
            if (confirm('Are you sure you want to reset this paper?')) {
                paperDiv.querySelectorAll('input').forEach(input => {
                    if (input.type === 'text' || input.type === 'number') {
                        input.value = '';
                    }
                });
                paperDiv.querySelector('.result').innerHTML = '';
                paperDiv.querySelector('.result').className = 'result';
                paperDiv.querySelector('.btn-save').disabled = true;
                paperDiv.querySelectorAll('.error').forEach(el => el.remove());
                showToast('Paper reset successfully!', 'info');
                
                // Focus on first input for better UX
                const firstInput = paperDiv.querySelector('input');
                if (firstInput) {
                    firstInput.focus();
                }
            }
        }

        // Enhanced delete paper function
        function deletePaper(paperDiv, credit) {
            const papersContainer = document.getElementById(`papers-${credit}`);
            const paperCount = papersContainer.children.length;
            
            if (paperCount <= 1) {
                showToast('Cannot delete the last paper! Add another paper first.', 'error');
                return;
            }
            
            if (confirm('Are you sure you want to delete this paper?')) {
                paperDiv.style.animation = 'slideOutUp 0.3s ease-in';
                setTimeout(() => {
                    paperDiv.remove();
                    showToast('Paper deleted successfully!', 'info');
                }, 300);
            }
        }

        // Enhanced add paper function
        function addPaper(credit) {
            const papersContainer = document.getElementById(`papers-${credit}`);
            const paperDiv = createPaperDiv(credit);
            papersContainer.appendChild(paperDiv);
            showToast('New paper added!', 'success');
            
            // Smooth scroll to new paper
            setTimeout(() => {
                paperDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                // Focus on first input
                const firstInput = paperDiv.querySelector('input');
                if (firstInput) {
                    firstInput.focus();
                }
            }, 100);
        }

        // Enhanced create paper div function
        function createPaperDiv(credit) {
            const paperDiv = document.createElement('div');
            paperDiv.className = 'paper';
            
            let labField = '';
            if (credit === '4' || credit === '4.5') {
                labField = `
                    <div class="form-group">
                        <label for="lab">Lab Marks (0-100):</label>
                        <input type="number" class="lab" min="0" max="100" placeholder="Enter lab marks" inputmode="decimal">
                    </div>
                `;
            }
            
            paperDiv.innerHTML = `
                <div class="form-group">
                    <label for="subject"> Subject Name (Optional):</label>
                    <input type="text" class="subject" placeholder="Enter subject name">
                </div>
                
                <div class="mobile-grid-2">
                    <div class="form-group">
                        <label for="assessment1"> Assessment 1 (0-50):</label>
                        <input type="number" class="assessment1" min="0" max="50" placeholder="Enter A1 marks" inputmode="decimal">
                    </div>
                    
                    <div class="form-group">
                        <label for="assessment2"> Assessment 2 (0-50):</label>
                        <input type="number" class="assessment2" min="0" max="50" placeholder="Enter A2 marks" inputmode="decimal">
                    </div>
                </div>
                
                <div class="mobile-grid-2">
                    <div class="form-group">
                        <label for="activity"> Activity Marks (0-10):</label>
                        <input type="number" class="activity" min="0" max="10" placeholder="Enter activity marks" inputmode="decimal">
                    </div>
                    
                    <div class="form-group">
                        <label for="theory"> Theory Marks (0-100):</label>
                        <input type="number" class="theory" min="0" max="100" placeholder="Enter theory marks" inputmode="decimal">
                    </div>
                </div>
                
                ${labField}
                
                <div class="button-group">
                    <button type="button" class="btn btn-calculate" onclick="calculateResult(this.closest('.paper'), '${credit}')">
                         Calculate
                    </button>
                    <button type="button" class="btn btn-save" onclick="alert('Calculate first to enable save')" disabled>
                         Save
                    </button>
                    <button type="button" class="btn btn-reset" onclick="resetPaper(this.closest('.paper'))">
                         Reset
                    </button>
                    <button type="button" class="btn btn-delete" onclick="deletePaper(this.closest('.paper'), '${credit}')">
                         Delete
                    </button>
                </div>
                
                <div class="result"></div>
            `;
            
            return paperDiv;
        }

        // Enhanced CGPA Calculator Functions
        function generateSubjectInputs() {
            const numSubjects = parseInt(document.getElementById('num-subjects').value);
            const form = document.getElementById('subjects-form');
            
            if (numSubjects < 1 || numSubjects > 20) {
                showToast('Number of subjects must be between 1 and 20', 'error');
                return;
            }
            
            form.innerHTML = '';
            
            for (let i = 1; i <= numSubjects; i++) {
                const subjectRow = document.createElement('div');
                subjectRow.className = 'subject-row';
                
                subjectRow.innerHTML = `
                    <div class="form-group">
                        <label> Subject ${i}:</label>
                        <input type="text" placeholder="Subject name (optional)" class="subject-name">
                    </div>
                    <div class="form-group">
                        <label>⚖ Credits:</label>
                        <input type="number" min="1" max="6" value="3" class="credits" required inputmode="decimal">
                    </div>
                    <div class="form-group">
                        <label> Grade:</label>
                        <select class="grade" required>
                            <option value="">Select Grade</option>
                            <option value="O">O (10 points)</option>
                            <option value="A+">A+ (9 points)</option>
                            <option value="A">A (8 points)</option>
                            <option value="B+">B+ (7 points)</option>
                            <option value="B">B (6 points)</option>
                            <option value="C">C (5 points)</option>
                            <option value="F">F (0 points)</option>
                        </select>
                    </div>
                `;
                
                form.appendChild(subjectRow);
            }
            
            showToast(`Generated inputs for ${numSubjects} subjects!`, 'success');
        }

        function calculateCGPA() {
            const subjectRows = document.querySelectorAll('.subject-row');
            let totalCredits = 0;
            let totalGradePoints = 0;
            let hasError = false;
            
            // Clear previous errors
            document.querySelectorAll('.error').forEach(el => el.remove());
            
            subjectRows.forEach((row, index) => {
                const creditsInput = row.querySelector('.credits');
                const gradeSelect = row.querySelector('.grade');
                
                const credits = parseInt(creditsInput.value);
                const grade = gradeSelect.value;
                
                if (!credits || credits < 1 || credits > 6) {
                    const error = document.createElement('div');
                    error.className = 'error';
                    error.textContent = 'Credits must be between 1 and 6';
                    creditsInput.parentNode.appendChild(error);
                    hasError = true;
                }
                
                if (!grade) {
                    const error = document.createElement('div');
                    error.className = 'error';
                    error.textContent = 'Please select a grade';
                    gradeSelect.parentNode.appendChild(error);
                    hasError = true;
                }
                
                if (!hasError && credits && grade) {
                    const gradePoints = gradeMap[grade];
                    totalCredits += credits;
                    totalGradePoints += credits * gradePoints;
                }
            });
            
            if (hasError) {
                showToast('Please fix the validation errors', 'error');
                return;
            }
            
            if (totalCredits === 0) {
                showToast('No valid subjects found', 'error');
                return;
            }
            
            const cgpa = totalGradePoints / totalCredits;
            const resultDiv = document.getElementById('cgpa-result');
            
            let performance = '';
            let emoji = '';
            if (cgpa >= 9) {
                performance = 'Outstanding!';
                emoji = '';
            } else if (cgpa >= 8) {
                performance = 'Excellent!';
                emoji = '';
            } else if (cgpa >= 7) {
                performance = 'Very Good!';
                emoji = '';
            } else if (cgpa >= 6) {
                performance = 'Good!';
                emoji = '';
            } else if (cgpa >= 5) {
                performance = 'Average';
                emoji = '';
            } else {
                performance = 'Needs Improvement';
                emoji = '';
            }
            
            resultDiv.innerHTML = `
                <div style="text-align: center;">
                    <h3> CGPA Calculation Result</h3>
                    <div style="font-size: 28px; margin: 20px 0; font-weight: bold;">
                        Your CGPA: ${cgpa.toFixed(2)}
                    </div>
                    <div style="font-size: 20px; margin: 15px 0;">
                        ${emoji} ${performance}
                    </div>
                </div>
                <div style="margin-top: 25px; padding: 20px; background: rgba(255,255,255,0.2); border-radius: 10px;">
                    <strong> Summary:</strong><br>
                    Total Credits: ${totalCredits}<br>
                    Total Grade Points: ${totalGradePoints}<br>
                    CGPA Formula: ${totalGradePoints} ÷ ${totalCredits} = ${cgpa.toFixed(2)}
                </div>
            `;
            
            resultDiv.style.display = 'block';
            showToast('CGPA calculated successfully!', 'success');
            
            // Smooth scroll to result
            setTimeout(() => {
                resultDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
        }

        // Enhanced scroll to top function
        function scrollToTop() {
            window.scrollTo({ 
                top: 0, 
                behavior: 'smooth' 
            });
        }

        // Enhanced initialize function
        function initializeApp() {
            // Initialize theme first
            initializeTheme();
            
            // Add initial papers for each credit type
            addPaper('3');
            addPaper('4');
            addPaper('4.5');
            
            // Set up CGPA calculator event listeners
            document.getElementById('generate-inputs').addEventListener('click', generateSubjectInputs);
            document.getElementById('calculate-cgpa').addEventListener('click', calculateCGPA);
            
            // Generate initial CGPA inputs
            generateSubjectInputs();
            
            // Add input event listeners for better mobile experience
            document.addEventListener('input', function(e) {
                if (e.target.matches('input[type="number"]')) {
                    // Remove any non-numeric characters except decimal point
                    const value = e.target.value.replace(/[^0-9.]/g, '');
                    if (value !== e.target.value) {
                        e.target.value = value;
                    }
                }
            });
            
            // Add touch feedback
            document.addEventListener('touchstart', function(e) {
                if (e.target.matches('.btn, .tab-btn, .main-tab-btn, .add-paper-btn, .theme-toggle')) {
                    e.target.style.transform = 'scale(0.98)';
                }
            });
            
            document.addEventListener('touchend', function(e) {
                if (e.target.matches('.btn, .tab-btn, .main-tab-btn, .add-paper-btn, .theme-toggle')) {
                    setTimeout(() => {
                        e.target.style.transform = '';
                    }, 150);
                }
            });
            
            // Show welcome message
            setTimeout(() => {
                showToast('Welcome to Ultimate Academic Calculator!', 'success');
            }, 500);
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);

        // Enhanced keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + S to save (prevent default)
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                showToast('Use the Save Result button to save calculations!', 'info');
            }
            
            // Escape key to clear focus and close mobile keyboard
            if (e.key === 'Escape') {
                document.activeElement.blur();
            }
            
            // Enter key to calculate if in a paper form
            if (e.key === 'Enter' && e.target.closest('.paper')) {
                const paper = e.target.closest('.paper');
                const calculateBtn = paper.querySelector('.btn-calculate');
                if (calculateBtn) {
                    calculateBtn.click();
                }
            }
        });

        // Enhanced scroll behavior for FAB
        let lastScrollTop = 0;
        window.addEventListener('scroll', function() {
            const fab = document.querySelector('.fab');
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            if (scrollTop > 300) {
                fab.style.opacity = '1';
                fab.style.visibility = 'visible';
                fab.style.transform = 'scale(1)';
            } else {
                fab.style.opacity = '0';
                fab.style.visibility = 'hidden';
                fab.style.transform = 'scale(0.8)';
            }
            
            // Hide FAB when scrolling down, show when scrolling up
            if (scrollTop > lastScrollTop && scrollTop > 500) {
                fab.style.transform = 'scale(0.8) translateY(100px)';
            } else if (scrollTop < lastScrollTop) {
                fab.style.transform = 'scale(1) translateY(0)';
            }
            
            lastScrollTop = scrollTop;
        }, { passive: true });

        // Add slideOutUp animation for deletions
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideOutUp {
                from {
                    opacity: 1;
                    transform: translateY(0);
                }
                to {
                    opacity: 0;
                    transform: translateY(-30px);
                }
            }
        `;
        document.head.appendChild(style);

        // Enhanced error handling for network issues
        window.addEventListener('online', () => {
            showToast('Connection restored!', 'success');
        });

        window.addEventListener('offline', () => {
            showToast('You are offline. Data will be stored locally.', 'info');
        });

        // Prevent zoom on input focus (iOS)
        if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
            const viewport = document.querySelector('meta[name="viewport"]');
            if (viewport) {
                viewport.setAttribute('content', 'width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no');
            }
        }
    </script>
</body>
</html>
